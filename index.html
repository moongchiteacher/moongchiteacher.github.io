<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인터랙티브 하이러닝 수업 설계 가이드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #F9FAFB;
            color: #374151;
            line-height: 1.7;
            word-break: keep-all;
        }
        .nav-btn {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            color: #4B5563;
        }
        .nav-btn.active {
            color: #8B5CF6;
            border-bottom-color: #8B5CF6;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .competency-btn.active {
            background-color: #8B5CF6;
            color: white;
            transform: scale(1.05);
        }
        .feature-card {
            transition: all 0.3s ease;
            opacity: 0.5;
            filter: grayscale(80%);
        }
        .feature-card.highlight {
            opacity: 1;
            filter: grayscale(0%);
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        select:disabled, button:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8B5CF6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-response-prose {
            color: #374151;
            line-height: 1.75;
            max-width: none;
        }
        .ai-response-prose p {
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
        }
        .ai-response-prose h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #5b21b6;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #ddd6fe;
        }
        .ai-response-prose ul {
            list-style-type: disc;
            margin-top: 1rem;
            margin-bottom: 1rem;
            padding-left: 1.75rem;
        }
        .ai-response-prose li {
            padding-left: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .ai-response-prose strong {
            color: #7c3aed;
            font-weight: 600;
        }
        .ai-response-prose hr {
            border-top: 1px solid #ddd6fe;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        .ai-response-prose > *:first-child {
            margin-top: 0;
        }

        /* API 키 설정 모달 스타일 */
        .api-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .api-modal-backdrop.show {
            visibility: visible;
            opacity: 1;
        }
        .api-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .api-modal-backdrop.show .api-modal-content {
            transform: scale(1);
        }
        
        .api-status {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .api-status.configured {
            background-color: #dcfce7;
            color: #166534;
        }
        .api-status.not-configured {
            background-color: #fed7d7;
            color: #c53030;
        }
    </style>
</head>
<body>

    <!-- API 키 설정 모달 -->
    <div id="apiModalBackdrop" class="api-modal-backdrop">
        <div class="api-modal-content">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">🔑 Gemini API 키 설정</h2>
            <p class="text-gray-600 mb-4 leading-relaxed">
                AI 기능을 사용하려면 Google Gemini API 키가 필요합니다. 
                API 키는 브라우저에만 저장되며 서버로 전송되지 않습니다.
            </p>
            
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                <h3 class="font-semibold text-blue-800 mb-2">API 키 발급 방법:</h3>
                <ol class="list-decimal list-inside text-blue-700 space-y-1 text-sm">
                    <li><a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline hover:text-blue-900">Google AI Studio</a>에 접속</li>
                    <li>"Create API Key" 버튼 클릭</li>
                    <li>생성된 API 키를 복사하여 아래에 입력</li>
                </ol>
            </div>

            <div class="mb-4">
                <label for="apiKeyInput" class="block mb-2 text-sm font-medium text-gray-900">API 키 입력</label>
                <input type="password" id="apiKeyInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="AIza...로 시작하는 API 키를 입력하세요">
            </div>

            <div class="flex gap-3">
                <button id="saveApiKeyBtn" class="flex-1 bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition">저장</button>
                <button id="closeModalBtn" class="flex-1 bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition">취소</button>
            </div>

            <div class="mt-4 text-xs text-gray-500">
                * API 키는 브라우저의 로컬 스토리지에만 저장되며, 페이지를 새로고침해도 유지됩니다.
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 md:py-16">
        <header class="text-center mb-12 md:mb-20">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-3">인터랙티브 하이러닝 수업 설계 가이드</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">2022 개정 교육과정 기반, 학생 주도성을 깨우는 미래 수업을 AI와 함께 디자인하세요.</p>
            
            <!-- API 키 상태 표시 -->
            <div class="mt-6 flex justify-center">
                <div class="flex items-center gap-3">
                    <span id="apiStatusSpan" class="api-status not-configured">
                        🔑 AI 기능을 위해 API 키가 필요합니다
                    </span>
                    <button id="configureApiBtn" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition text-sm">
                        API 키 설정
                    </button>
                </div>
            </div>
        </header>

        <nav class="mb-12 border-b border-gray-200">
            <ul class="flex flex-wrap justify-center -mb-px text-lg font-medium text-center">
                <li><button class="nav-btn inline-block p-4 active" data-target="why">왜 하이러닝인가?</button></li>
                <li><button class="nav-btn inline-block p-4" data-target="guides">수업 모델별 가이드</button></li>
                <li><button class="nav-btn inline-block p-4" data-target="lesson-planner">성취기준별 설계</button></li>
                <li><button class="nav-btn inline-block p-4" data-target="features">주요 기능 둘러보기</button></li>
                <li><button class="nav-btn inline-block p-4" data-target="qna">AI Q&A</button></li>
                <li><button class="nav-btn inline-block p-4" data-target="future">전략과 미래</button></li>
            </ul>
        </nav>

        <main>
            <section id="why" class="content-section active"></section>
            <section id="guides" class="content-section"></section>
            <section id="lesson-planner" class="content-section"></section>
            <section id="features" class="content-section"></section>
            <section id="qna" class="content-section"></section>
            <section id="future" class="content-section"></section>
        </main>

        <footer class="text-center mt-20 pt-10 border-t border-gray-200">
            <p class="text-sm text-gray-500">본 애플리케이션은 제공된 연구 보고서 및 교육과정 자료를 기반으로 제작된 대화형 가이드입니다.</p>
        </footer>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- API 키 관리 ---
        let apiKey = localStorage.getItem('gemini-api-key') || '';

        const updateApiStatus = () => {
            const apiStatus = document.getElementById('apiStatusSpan');
            const configureBtn = document.getElementById('configureApiBtn');
            
            if (apiKey) {
                apiStatus.textContent = '✅ API 키가 설정되었습니다';
                apiStatus.className = 'api-status configured';
                configureBtn.textContent = 'API 키 변경';
            } else {
                apiStatus.textContent = '🔑 AI 기능을 위해 API 키가 필요합니다';
                apiStatus.className = 'api-status not-configured';
                configureBtn.textContent = 'API 키 설정';
            }
        };

        const showApiModal = () => {
            const modal = document.getElementById('apiModalBackdrop');
            const input = document.getElementById('apiKeyInput');
            if (modal && input) {
                input.value = apiKey;
                modal.classList.add('show');
            }
        };

        const hideApiModal = () => {
            const modal = document.getElementById('apiModalBackdrop');
            if (modal) {
                modal.classList.remove('show');
            }
        };

        const saveApiKey = () => {
            const input = document.getElementById('apiKeyInput');
            const newApiKey = input.value.trim();
            
            if (newApiKey && newApiKey.startsWith('AIza')) {
                apiKey = newApiKey;
                localStorage.setItem('gemini-api-key', apiKey);
                updateApiStatus();
                hideApiModal();
                alert('API 키가 저장되었습니다!');
            } else {
                alert('올바른 Gemini API 키를 입력해주세요. (AIza로 시작해야 합니다)');
            }
        };

        const checkApiKey = () => {
            if (!apiKey) {
                alert('먼저 API 키를 설정해주세요.');
                showApiModal();
                return false;
            }
            return true;
        };

        // 이벤트 리스너 등록
        document.getElementById('configureApiBtn').addEventListener('click', showApiModal);
        document.getElementById('saveApiKeyBtn').addEventListener('click', saveApiKey);
        document.getElementById('closeModalBtn').addEventListener('click', hideApiModal);
        document.getElementById('apiKeyInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveApiKey();
            }
        });

        // 모달 외부 클릭 시 닫기
        document.getElementById('apiModalBackdrop').addEventListener('click', (e) => {
            if (e.target.id === 'apiModalBackdrop') {
                hideApiModal();
            }
        });

        updateApiStatus();

        // --- 기존 데이터 (2022 개정 교육과정 성취기준) ---
        const lessonDesigns = {
            middleSchool: {
                "국어": {
                    "(듣기·말하기)": {
                        "[9국01-01]": { standard: "[9국01-01] 화자의 의도와 관점을 추론하며 듣는다." },
                        "[9국01-02]": { standard: "[9국01-02] 설득 전략을 비판적으로 분석하며 듣는다." },
                        "[9국01-03]": { standard: "[9국01-03] 담화 공동체에 따른 듣기·말하기 방식의 다양성을 고려하여 듣고 말한다." }
                    },
                    "(읽기)": {
                        "[9국02-01]": { standard: "[9국02-01] 읽기는 사회·문화적 맥락에서 의미를 구성하는 과정임을 이해하며 사회적 독서에 참여하고 사회적 독서 문화 형성에 기여한다." },
                        "[9국02-02]": { standard: "[9국02-02] 읽기 목적과 글의 구조를 고려하며 글을 효과적으로 요약한다." }
                    },
                    "(쓰기)": {
                        "[9국03-01]": { standard: "[9국03-01] 대상의 특성에 적합한 설명 방법을 활용하여 글을 쓴다." },
                        "[9국03-02]": { standard: "[9국03-02] 복수의 자료를 활용하여 다양한 형식으로 정보를 전달하는 글을 쓴다." }
                    }
                },
                "수학": {
                    "수와 연산": {
                        "[9수01-01]": { standard: "[9수01-01] 소인수분해의 뜻을 알고, 자연수를 소인수분해할 수 있다." },
                        "[9수01-02]": { standard: "[9수01-02] 최대공약수와 최소공배수의 성질을 이해하고, 이를 활용하여 문제를 해결할 수 있다." }
                    },
                    "문자와 식": {
                        "[9수02-01]": { standard: "[9수02-01] 다양한 상황을 문자를 사용한 식으로 나타내어 그 유용성을 인식하고, 식의 값을 구할 수 있다." },
                        "[9수02-02]": { standard: "[9수02-02] 다항식의 덧셈과 뺄셈의 원리를 이해하고, 그 계산을 할 수 있다." }
                    }
                }
            },
            highSchool: {
                "공통국어": {
                    "(1) 듣기·말하기": {
                        "[10국01-01]": { standard: "[10국01-01] 듣기·말하기는 의미를 공유하고 상호 작용하며 관계를 형성하고 발전시키는 활동임을 이해하고 듣기·말하기 활동을 한다." },
                        "[10국01-02]": { standard: "[10국01-02] 화자의 말을 예견하고 화자의 의도나 목적, 말하는 방식 등을 종합하여 내용을 비판적으로 듣는다." }
                    },
                    "(2) 읽기": {
                        "[10국02-01]": { standard: "[10국02-01] 읽기는 글에 드러난 정보와 독자의 배경지식, 읽기 맥락을 활용하여 문제를 해결하고 의미를 구성하는 과정임을 이해하고 글을 읽는다." },
                        "[10국02-02]": { standard: "[10국02-02] 읽기의 사회·문화적 가치를 이해하고 책임감 있는 태도로 읽기 활동을 한다." }
                    }
                },
                "공통수학": {
                    "(1) 다항식": {
                        "[10공수1-01-01]": { standard: "[10공수1-01-01] 다항식의 사칙연산의 원리를 설명하고, 그 계산을 할 수 있다." },
                        "[10공수1-01-02]": { standard: "[10공수1-01-02] 항등식의 성질과 나머지정리를 이해하고, 이를 활용하여 문제를 해결할 수 있다." }
                    },
                    "(2) 방정식과 부등식": {
                        "[10공수1-02-01]": { standard: "[10공수1-02-01] 복소수의 뜻과 사칙연산의 원리를 이해하고, 그 계산을 할 수 있다." },
                        "[10공수1-02-02]": { standard: "[10공수1-02-02] 이차방정식의 실근과 허근을 이해하고, 판별식을 이용하여 이차방정식의 근을 판별할 수 있다." }
                    }
                }
            }
        };
        
        const modelGuides = {
            inquiry: { 
                title: "질문하는 수업 (Inquiry-Based)", 
                description: "학생이 스스로 질문을 만들고 답을 찾아가는 과정을 통해 학생 주도성을 극대화하는 수업 모델입니다.", 
                steps: [
                    { title: "1단계: 탐구 시작하기", content: "교사는 수업의 도입부에서 학생들의 호기심을 자극할 만한 이미지, 짧은 영상, 혹은 정답이 없는 개방형 질문을 '통합학습창'에 제시합니다." }, 
                    { title: "2단계: 질문 생성하기", content: "학생들은 제시된 자료를 보고 떠오르는 질문들을 '수업 질문' 기능을 통해 실시간으로 교사에게 제출합니다." }, 
                    { title: "3단계: 탐구 계획하기", content: "'우리반 게시판'이나 모둠별 채널을 활용하여 탐구 계획, 역할 분담, 자료 수집 방법 등을 논의하고 기록합니다." }
                ] 
            },
            process: { 
                title: "과정중심 수업 (Process-Focused)", 
                description: "결과물뿐만 아니라, 학습이 일어나는 전 과정을 평가하고 피드백함으로써 학생의 성장을 지원합니다.", 
                steps: [
                    { title: "1-2단계: 목표 공유 및 초기 진단", content: "교사는 단원의 시작에 학습 목표와 평가 기준(루브릭)을 '통합학습창'에 공지하고, 'AI 학습 진단' 기능으로 학생들의 출발점을 확인합니다." }, 
                    { title: "3단계: 과정 기록하기", content: "학생들은 글쓰기, 프로젝트 등을 진행하며 그 과정과 결과물을 주기적으로 '클래스보드'에 포트폴리오처럼 업로드합니다." }
                ] 
            },
            concept: { 
                title: "개념기반 수업 (Concept-Based)", 
                description: "단편적인 사실의 암기를 넘어, 교과의 핵심 개념과 일반화를 탐구하여 지식의 전이력을 높이는 데 중점을 둡니다.", 
                steps: [
                    { title: "1단계: 사전 지식 확인", content: "수업은 '정의란 무엇인가?'와 같은 핵심 개념 질문으로 시작합니다." }, 
                    { title: "2단계: 다양한 맥락 속 개념 탐색", content: "교사는 '통합학습창'을 통해 핵심 개념을 다양한 각도에서 조명하는 자료 묶음을 제공합니다." }
                ] 
            },
            design: { 
                title: "디자인 씽킹 수업 (Design Thinking)", 
                description: "사용자에 대한 공감을 바탕으로 창의적인 해결책을 만들어가는 협력적 문제 해결 과정입니다.", 
                steps: [
                    { title: "1단계: 공감하기", content: "사용자 인터뷰나 관찰 후, '통합학습창'의 화이트보드에 모여 협력적으로 '공감 지도'를 작성합니다." }, 
                    { title: "2단계: 문제 정의하기", content: "공감 지도를 바탕으로, 각 모둠은 해결해야 할 핵심 문제를 명확한 문장으로 정의합니다." }
                ] 
            }
        };

        const formatAiResponseToHtml = (text) => {
            return text
                .replace(/^### (.*$)/gm, '<h4>$1</h4>')
                .replace(/^---$/gm, '<hr>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/((?:(?:^|\n)\* .*(?:\n|$))+)/gm, (match) => {
                    const items = match.trim().split('\n')
                        .map(line => `<li>${line.substring(line.indexOf('*') + 1).trim()}</li>`)
                        .join('');
                    return `<ul>${items}</ul>`;
                })
                .split('\n')
                .map(line => {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) return ''; 
                    if (trimmedLine.startsWith('<h4') || trimmedLine.startsWith('<ul') || trimmedLine.startsWith('<hr') || trimmedLine.startsWith('<li>')) {
                        return line;
                    }
                    return `<p>${trimmedLine}</p>`;
                })
                .join('')
                .replace(/<p><ul>/g, '<ul>')
                .replace(/<\/ul><\/p>/g, '</ul>');
        };

        const callGeminiAPI = async (prompt) => {
            if (!checkApiKey()) return null;
            
            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("응답 형식이 올바르지 않습니다.");
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                throw error;
            }
        };

        const setupAll = () => {
            const main = document.querySelector('main');
            
            main.innerHTML = `
                <section id="why" class="content-section active"></section>
                <section id="guides" class="content-section"></section>
                <section id="lesson-planner" class="content-section"></section>
                <section id="features" class="content-section"></section>
                <section id="qna" class="content-section"></section>
                <section id="future" class="content-section"></section>
            `;
            
            setupStaticContent();
            setupWhySection();
            setupGuidesSection();
            setupLessonPlannerSection();
            setupQnaSection();

            const navBtns = document.querySelectorAll('.nav-btn');
            const contentSections = document.querySelectorAll('.content-section');
            navBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    navBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    contentSections.forEach(section => {
                        section.classList.toggle('active', section.id === btn.dataset.target);
                    });
                });
            });
        };
        
        const setupStaticContent = () => {
            const featuresSection = document.getElementById('features');
            if (featuresSection) {
                featuresSection.innerHTML = `
                <h2 class="text-3xl font-bold text-center mb-4">주요 기능 둘러보기</h2>
                <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">
                    하이러닝은 교사를 '학습 경험 설계자'로 만들어주는 강력한 도구 모음입니다.
                </p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition">
                        <h3 class="font-bold text-xl mb-2 text-purple-700">AI 기반 맞춤 학습</h3>
                        <p class="text-gray-600 leading-relaxed">AI가 학생의 지식 수준을 진단하고, 개인별 최적의 학습 경로를 제공합니다.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition">
                        <h3 class="font-bold text-xl mb-2 text-purple-700">수업 설계 및 관리</h3>
                        <p class="text-gray-600 leading-relaxed">교사는 자신의 수업 자료를 등록·공유하고, 동료 교사의 우수한 수업 설계안을 활용할 수 있습니다.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition">
                        <h3 class="font-bold text-xl mb-2 text-purple-700">상호작용 수업 도구</h3>
                        <p class="text-gray-600 leading-relaxed">통합학습창 내 화이트보드, 설문, 퀴즈, 발표 등의 기능으로 역동적인 수업을 만들 수 있습니다.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition">
                        <h3 class="font-bold text-xl mb-2 text-purple-700">데이터 기반 피드백</h3>
                        <p class="text-gray-600 leading-relaxed">AI 리포트와 대시보드로 학생의 학습 과정을 가시화하고 효과적인 피드백을 제공합니다.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition">
                        <h3 class="font-bold text-xl mb-2 text-purple-700">과정중심평가 지원</h3>
                        <p class="text-gray-600 leading-relaxed">클래스보드에 축적된 학생들의 활동 결과물은 과정중심평가를 위한 풍부한 근거가 됩니다.</p>
                    </div>
                </div>

                <div class="mt-20">
                    <h3 class="text-3xl font-bold text-center mb-4">영상으로 배우는 하이러닝 마스터</h3>
                    <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">경기도교육청에서 제공하는 공식 유튜브 튜토리얼 영상으로 하이러닝의 핵심 기능을 빠르게 익혀보세요.</p>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <a href="https://www.youtube.com/watch?v=C8sNaNQwgEM" target="_blank" class="block bg-white rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden">
                            <img src="https://img.youtube.com/vi/C8sNaNQwgEM/hqdefault.jpg" alt="영상 썸네일" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h4 class="font-bold text-lg text-purple-800">1편: 수업개설 및 학생초대</h4>
                                <p class="text-gray-600 mt-2">새로운 수업을 만들고 학생들을 초대하는 가장 첫 단계를 배워보세요.</p>
                            </div>
                        </a>
                         <a href="https://www.youtube.com/watch?v=ynpH8Nvrg4A" target="_blank" class="block bg-white rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden">
                            <img src="https://img.youtube.com/vi/ynpH8Nvrg4A/hqdefault.jpg" alt="영상 썸네일" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h4 class="font-bold text-lg text-purple-800">2편: 수업자료 등록 및 제작</h4>
                                <p class="text-gray-600 mt-2">PDF, 영상 등 다양한 자료를 등록하고 하이러닝 콘텐츠로 만드는 법을 알아봅니다.</p>
                            </div>
                        </a>
                         <a href="https://www.youtube.com/watch?v=gfEsZbmdsYc" target="_blank" class="block bg-white rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden">
                            <img src="https://img.youtube.com/vi/gfEsZbmdsYc/hqdefault.jpg" alt="영상 썸네일" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h4 class="font-bold text-lg text-purple-800">3편: 수업실행 및 클래스보드</h4>
                                <p class="text-gray-600 mt-2">통합학습창을 활용한 실시간 수업과 클래스보드로 결과물을 확인하는 법을 배웁니다.</p>
                            </div>
                        </a>
                         <a href="https://www.youtube.com/watch?v=E3NTzqAKD5A" target="_blank" class="block bg-white rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden">
                            <img src="https://img.youtube.com/vi/E3NTzqAKD5A/hqdefault.jpg" alt="영상 썸네일" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h4 class="font-bold text-lg text-purple-800">4편: 모둠활동 및 토의토론</h4>
                                <p class="text-gray-600 mt-2">학생 주도성을 키우는 핵심, 모둠 활동과 토의/토론 기능을 마스터합니다.</p>
                            </div>
                        </a>
                         <a href="https://www.youtube.com/watch?v=B4ufK_vJ-e0" target="_blank" class="block bg-white rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden">
                            <img src="https://img.youtube.com/vi/B4ufK_vJ-e0/hqdefault.jpg" alt="영상 썸네일" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h4 class="font-bold text-lg text-purple-800">5편: AI 맞춤형 학습</h4>
                                <p class="text-gray-600 mt-2">AI 진단평가, 맞춤형 학습지 등 하이러닝의 AI 기능을 깊이 있게 알아봅니다.</p>
                            </div>
                        </a>
                    </div>
                </div>
                `;
            }
            const futureSection = document.getElementById('future');
            if (futureSection) futureSection.innerHTML = `
                <h2 class="text-3xl font-bold text-center mb-4">전략적 실행과 미래 전망</h2>
                <p class="max-w-3xl mx-auto text-center text-gray-600 mb-12 leading-relaxed">하이러닝의 성공적인 도입은 기술적 숙달을 넘어, 교육 철학에 기반한 전략적 접근이 필요합니다.</p>
                <div class="grid md:grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg border-l-4 border-red-400">
                        <h3 class="font-bold text-xl mb-3">⚠️ 도전 과제 탐색</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 leading-relaxed">
                            <li><strong>데이터 프라이버시와 보안:</strong> 학생의 민감 정보 보호</li>
                            <li><strong>알고리즘 편향:</strong> 정량적 능력 편중 위험</li>
                            <li><strong>디지털 격차:</strong> 기기 및 가정 환경에 따른 교육 불평등</li>
                            <li><strong>교사 역량:</strong> 새로운 교수법 연수 필요</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg border-l-4 border-green-400">
                        <h3 class="font-bold text-xl mb-3">🚀 성공적 도입을 위한 제언</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 leading-relaxed">
                            <li><strong>비전 중심의 리더십:</strong> '학생 주도성 신장' 등 교육적 비전 제시</li>
                            <li><strong>협력적 문화 구축:</strong> 전문적 학습공동체 활성화</li>
                            <li><strong>점진적 접근:</strong> 작은 성공 경험 축적</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg border-l-4 border-blue-400">
                        <h3 class="font-bold text-xl mb-3">🛰️ 다가오는 통합 생태계</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 leading-relaxed">
                            <li><strong>국가 AIDT와 연동:</strong> 통합된 학습 생태계 구축</li>
                            <li><strong>교사의 역할 진화:</strong> 학습 설계자, 데이터 기반 멘토로 변화</li>
                            <li><strong>학생의 공동 설계자 부상:</strong> 학습 경로 선택의 주도권 확대</li>
                        </ul>
                    </div>
                </div>
                <p class="mt-12 text-center text-gray-600 bg-gray-50 p-6 rounded-lg leading-relaxed">결국 하이러닝과 AI 디지털교과서는 학교를 위한 '교육용 운영체제'를 구축하는 것입니다. 하이러닝의 전략적 활용은 미래를 준비하는 가장 중요한 첫걸음이 될 것입니다.</p>`;
        };

        const setupWhySection = () => {
            const whySection = document.getElementById('why');
            if (!whySection) return;

            whySection.innerHTML = `<div class="space-y-16 md:space-y-24">
                <div>
                    <h2 class="text-3xl font-bold text-center mb-4">교육의 패러다임 전환: 2015 vs 2022</h2>
                    <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">
                        2015 개정 교육과정이 '역량'의 씨앗을 심었다면, 2022 개정 교육과정은 학생이 학습의 주인이 되는 '학생 주도성'의 꽃을 피우려 합니다.
                    </p>
                    <div class="chart-container"><canvas id="curriculumRadarChart"></canvas></div>
                    <div class="flex justify-center items-center gap-4 mt-6">
                        <button id="show2015Chart" class="bg-orange-400 text-white font-semibold py-2 px-5 rounded-full hover:bg-orange-500 transition">2015 교육과정</button>
                        <button id="show2022Chart" class="bg-purple-500 text-white font-semibold py-2 px-5 rounded-full hover:bg-purple-600 transition">2022 교육과정</button>
                        <button id="resetChart" class="bg-gray-500 text-white font-semibold py-2 px-5 rounded-full hover:bg-gray-600 transition">초기화</button>
                    </div>
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-center mb-4">핵심역량과 하이러닝의 연결</h2>
                    <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">
                        2022 개정 교육과정이 제시하는 6대 핵심역량은 어떻게 길러질 수 있을까요? 아래 역량을 클릭하여 관련된 하이러닝의 핵심 기능들을 탐색해 보세요.
                    </p>
                    <div class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
                        <button class="competency-btn transition-all duration-300 ease-in-out text-sm md:text-base bg-white shadow-md hover:bg-purple-600 hover:text-white font-semibold py-2 px-4 border border-gray-200 rounded-full" data-competency="self-management">자기관리 역량</button>
                        <button class="competency-btn transition-all duration-300 ease-in-out text-sm md:text-base bg-white shadow-md hover:bg-purple-600 hover:text-white font-semibold py-2 px-4 border border-gray-200 rounded-full" data-competency="knowledge-info">지식정보처리 역량</button>
                        <button class="competency-btn transition-all duration-300 ease-in-out text-sm md:text-base bg-white shadow-md hover:bg-purple-600 hover:text-white font-semibold py-2 px-4 border border-gray-200 rounded-full" data-competency="creative-thinking">창의적 사고 역량</button>
                        <button class="competency-btn transition-all duration-300 ease-in-out text-sm md:text-base bg-white shadow-md hover:bg-purple-600 hover:text-white font-semibold py-2 px-4 border border-gray-200 rounded-full" data-competency="aesthetic-emotional">심미적 감성 역량</button>
                        <button class="competency-btn transition-all duration-300 ease-in-out text-sm md:text-base bg-white shadow-md hover:bg-purple-600 hover:text-white font-semibold py-2 px-4 border border-gray-200 rounded-full" data-competency="collaborative-communication">협력적 소통 역량</button>
                        <button class="competency-btn transition-all duration-300 ease-in-out text-sm md:text-base bg-white shadow-md hover:bg-purple-600 hover:text-white font-semibold py-2 px-4 border border-gray-200 rounded-full" data-competency="community">공동체 역량</button>
                    </div>
                    <div id="competency-description" class="p-6 bg-purple-50 border-l-4 border-purple-500 text-purple-800 rounded-r-lg min-h-[100px] flex items-center justify-center transition-all duration-300 ease-in-out"><p class="text-center">궁금한 핵심역량을 클릭해 주세요.</p></div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mt-10">
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="self-management knowledge-info"><h3 class="font-bold">AI 학습 진단/리포트</h3><p class="text-sm text-gray-600">학습 현황 분석으로<br>목표 설정을 돕습니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="knowledge-info"><h3 class="font-bold">AI 콘텐츠 추천/챗봇</h3><p class="text-sm text-gray-600">정보 탐색, 평가, 종합<br>능력을 지원합니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="creative-thinking collaborative-communication"><h3 class="font-bold">통합학습창(화이트보드)</h3><p class="text-sm text-gray-600">아이디어 브레인스토밍 및<br>문제 해결을 돕습니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="self-management"><h3 class="font-bold">오답 노트</h3><p class="text-sm text-gray-600">실수 성찰과 메타인지<br>능력을 기릅니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="creative-thinking"><h3 class="font-bold">AI 논술 진단</h3><p class="text-sm text-gray-600">논리적 주장과 창의적<br>표현력을 향상시킵니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="aesthetic-emotional community collaborative-communication"><h3 class="font-bold">우리반 게시판/클래스보드</h3><p class="text-sm text-gray-600">결과물 공유와<br>상호작용으로 소통합니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="collaborative-communication"><h3 class="font-bold">실시간 설문/퀴즈</h3><p class="text-sm text-gray-600">모든 학생의 참여를 유도하고<br>의견을 수렴합니다.</p></div>
                        <div class="feature-card bg-white p-4 rounded-lg shadow-md" data-feature="community collaborative-communication"><h3 class="font-bold">모둠 활동</h3><p class="text-sm text-gray-600">의견 조율과 건설적<br>피드백을 경험합니다.</p></div>
                    </div>
                </div>
            </div>`;

            // Chart.js 가 로드되었는지 확인
            if (typeof Chart === 'undefined') {
                console.error('Chart.js가 로드되지 않았습니다.');
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.innerHTML = '<p class="text-center text-gray-500">차트를 로드하는 중에 문제가 발생했습니다.</p>';
                }
                return;
            }

            const curriculumRadarChartEl = document.getElementById('curriculumRadarChart');
            if (!curriculumRadarChartEl) return;
            
            try {
                const radarCtx = curriculumRadarChartEl.getContext('2d');
                
                const radarData2015 = { label: '2015 개정 교육과정', data: [4, 3, 3, 2, 3, 2], backgroundColor: 'rgba(251, 146, 60, 0.2)', borderColor: 'rgb(251, 146, 60)', borderWidth: 2, pointBackgroundColor: 'rgb(251, 146, 60)' };
                const radarData2022 = { label: '2022 개정 교육과정', data: [5, 5, 5, 4, 5, 4], backgroundColor: 'rgba(139, 92, 246, 0.2)', borderColor: 'rgb(139, 92, 246)', borderWidth: 2, pointBackgroundColor: 'rgb(139, 92, 246)' };
                const radarLabels = ['추구하는 인간상', '핵심역량 초점', '핵심 교육 용어', '디지털 교육', '평가 패러다임', '학교 자율성'];

                const radarChart = new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: radarLabels,
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                                grid: { color: 'rgba(0, 0, 0, 0.1)' },
                                pointLabels: { font: { size: 12 }, color: '#374151' },
                                ticks: { stepSize: 1, backdropColor: 'rgba(255, 255, 255, 0.7)', color: '#6b7280' },
                                suggestedMin: 0,
                                suggestedMax: 5
                            }
                        },
                        plugins: {
                            legend: { labels: { font: { size: 14 } } }
                        }
                    }
                });

                document.getElementById('show2015Chart')?.addEventListener('click', () => {
                    const exists = radarChart.data.datasets.some(ds => ds.label === radarData2015.label);
                    if (!exists) {
                        radarChart.data.datasets.push(radarData2015);
                        radarChart.update();
                    }
                });

                document.getElementById('show2022Chart')?.addEventListener('click', () => {
                    const exists = radarChart.data.datasets.some(ds => ds.label === radarData2022.label);
                    if (!exists) {
                        radarChart.data.datasets.push(radarData2022);
                        radarChart.update();
                    }
                });
                
                document.getElementById('resetChart')?.addEventListener('click', () => {
                    radarChart.data.datasets = [];
                    radarChart.update();
                });
            } catch (error) {
                console.error('차트 생성 중 오류:', error);
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.innerHTML = '<p class="text-center text-gray-500">차트를 생성하는 중에 문제가 발생했습니다.</p>';
                }
                return; // 차트 생성에 실패하면 여기서 종료
            }

        // 핵심역량 버튼 기능을 별도 함수로 분리
        const setupCompetencyButtons = () => {
            // DOM이 완전히 생성된 후에 실행
            setTimeout(() => {
                const competencyBtns = document.querySelectorAll('.competency-btn');
                const featureCards = document.querySelectorAll('.feature-card');
                const competencyDesc = document.getElementById('competency-description');
                
                console.log('핵심역량 버튼 개수:', competencyBtns.length); // 디버깅용
                
                const descriptions = { 
                    'self-management': "AI 리포트, 오답 노트 등으로 자신의 학습 현황을 점검하고, 학습 목표를 설정하며 자기주도적 학습 능력을 기릅니다.", 
                    'knowledge-info': "AI 콘텐츠 추천, 챗봇 등을 활용하여 다양한 정보를 비판적으로 탐색, 평가, 종합하는 능력을 훈련합니다.", 
                    'creative-thinking': "통합학습창의 화이트보드, 발표 기능 등을 활용하여 아이디어를 발상하고 구체화하며 창의성을 발현합니다.", 
                    'aesthetic-emotional': "다양한 매체로 자신의 생각과 감정을 표현하고, 클래스보드나 게시판에서 타인의 감성에 공감하는 능력을 키웁니다.", 
                    'collaborative-communication': "통합학습창의 모둠 활동, 실시간 설문/퀴즈, 클래스보드 등을 통해 의견을 조율하고 공동의 목표를 달성하는 협력적 문제 해결을 경험합니다.", 
                    'community': "게시판 토론, 클래스보드 동료 피드백을 통해 학급 공동체의 학습에 기여하며 민주 시민 의식을 함양합니다."
                };
                
                competencyBtns.forEach((btn, index) => {
                    console.log(`버튼 ${index + 1} 이벤트 리스너 등록:`, btn.dataset.competency); // 디버깅용
                    
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('버튼 클릭됨:', btn.dataset.competency); // 디버깅용
                        
                        const targetCompetency = btn.dataset.competency;
                        
                        if (btn.classList.contains('active')) {
                            // 이미 활성화된 버튼을 다시 클릭한 경우 - 비활성화
                            btn.classList.remove('active');
                            featureCards.forEach(card => card.classList.remove('highlight'));
                            if (competencyDesc) {
                                competencyDesc.innerHTML = `<p class="text-center">궁금한 핵심역량을 클릭해 주세요.</p>`;
                            }
                        } else {
                            // 새로운 버튼을 클릭한 경우 - 활성화
                            competencyBtns.forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            
                            if (competencyDesc && descriptions[targetCompetency]) {
                                competencyDesc.innerHTML = `<p>${descriptions[targetCompetency]}</p>`;
                            }
                            
                            featureCards.forEach(card => {
                                if (card.dataset.feature && card.dataset.feature.includes(targetCompetency)) {
                                    card.classList.add('highlight');
                                } else {
                                    card.classList.remove('highlight');
                                }
                            });
                        }
                    });
                });
            }, 100); // 100ms 후에 실행하여 DOM이 완전히 렌더링되도록 함
        };

        const setupGuidesSection = () => {
            const guidesSection = document.getElementById('guides');
            if(!guidesSection) return;
            
            guidesSection.innerHTML = `
                <h2 class="text-3xl font-bold text-center mb-4">수업 모델별 하이러닝 활용 가이드</h2>
                <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">학생중심 수업을 하이러닝으로 어떻게 구현할 수 있을까요? 네 가지 대표적인 수업 모형에 대한 단계별 활용 전략을 확인하고, 실제 수업 주제를 입력하여 AI 기반 맞춤 설계안을 받아보세요.</p>
                <div class="lg:flex lg:space-x-8">
                    <div id="model-nav" class="lg:w-1/4 mb-8 lg:mb-0">
                        <ul class="space-y-2">
                            <li><button class="w-full text-left p-4 rounded-lg font-semibold bg-white shadow transition model-nav-btn active" data-model="inquiry">❓ 질문하는 수업</button></li>
                            <li><button class="w-full text-left p-4 rounded-lg font-semibold bg-white shadow transition model-nav-btn" data-model="process">📈 과정중심 수업</button></li>
                            <li><button class="w-full text-left p-4 rounded-lg font-semibold bg-white shadow transition model-nav-btn" data-model="concept">🌍 개념기반 수업</button></li>
                            <li><button class="w-full text-left p-4 rounded-lg font-semibold bg-white shadow transition model-nav-btn" data-model="design">💡 디자인 씽킹 수업</button></li>
                        </ul>
                    </div>
                    <div id="model-content" class="lg:w-3/4"></div>
                </div>`;

            const modelNavBtns = document.querySelectorAll('.model-nav-btn');
            const modelContent = document.getElementById('model-content');
            
            const renderModelContent = (modelKey) => {
                const model = modelGuides[modelKey];
                let stepsHtml = model.steps.map(step => `
                    <div class="step-item border-t border-gray-200 py-5 first:border-t-0 first:pt-0 last:pb-0">
                        <h4 class="font-bold text-lg mb-2 text-gray-800">${step.title}</h4>
                        <p class="text-gray-700 leading-relaxed">${step.content}</p>
                    </div>`).join('');
                
                modelContent.innerHTML = `
                    <div class="model-details active" data-model="${modelKey}">
                        <div class="bg-white p-8 rounded-xl shadow-lg">
                            <h3 class="text-2xl font-bold mb-3">${model.title}</h3>
                            <p class="mb-8 text-gray-600 leading-relaxed">${model.description}</p>
                            <div class="steps-container">
                                ${stepsHtml}
                            </div>
                            <div class="mt-10 pt-6 border-t-2 border-purple-200">
                                <h4 class="text-xl font-bold text-purple-700 mb-4">✨ AI 맞춤형 수업 설계</h4>
                                <p class="text-gray-600 mb-4 leading-relaxed">아래에 수업 주제나 활동 내용을 입력하고 버튼을 누르면, AI가 위 모델에 맞춰 상세한 수업 설계안을 제안해 드립니다.</p>
                                <textarea id="ai-topic-input-${modelKey}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" rows="3" placeholder="예: 기후 변화의 원인과 해결 방안 토론하기"></textarea>
                                <button class="ai-design-btn mt-4 w-full bg-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-purple-700 transition duration-300" data-model-key="${modelKey}">AI 맞춤 설계 받기</button>
                                <div id="ai-design-output-${modelKey}" class="mt-6"></div>
                            </div>
                        </div>
                    </div>`;
                
                addAiDesignListener(modelKey);
            };
            
            const addAiDesignListener = (modelKey) => {
                const button = document.querySelector(`.ai-design-btn[data-model-key="${modelKey}"]`);
                if(button) {
                    button.addEventListener('click', async () => {
                        const input = document.getElementById(`ai-topic-input-${modelKey}`);
                        const outputDiv = document.getElementById(`ai-design-output-${modelKey}`);
                        const topic = input.value;
                        const model = modelGuides[modelKey];

                        if (!topic.trim()) {
                            outputDiv.innerHTML = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg" role="alert"><p>수업 주제나 활동 내용을 입력해주세요.</p></div>`;
                            return;
                        }

                        outputDiv.innerHTML = `<div class="flex flex-col items-center justify-center p-8"><div class="loader"></div><p class="mt-4 text-gray-600">Gemini AI가 수업을 설계 중입니다...</p></div>`;
                        
                        const prompt = `당신은 대한민국 중/고등학교 교사들을 위한 수업 설계 전문가입니다. '${model.title}' 모델의 각 단계에 맞춰, 다음 활동 주제를 중심으로 구체적인 하이러닝 활용 수업 설계안을 작성해주세요. 각 단계별로 학생들이 무엇을 해야 하는지, 그리고 교사가 하이러닝의 어떤 기능을 어떻게 활용할 수 있는지 상세히 설명해야 합니다.
                        
                        **활동 주제:** ${topic}
                        
                        **설계 형식:**
                        ### 1단계: ${model.steps[0].title.split('(')[0].trim()}
                        * **활동 내용:** * **하이러닝 활용:** ### 2단계: ${model.steps[1].title.split('(')[0].trim()}
                        * **활동 내용:** * **하이러닝 활용:** (모든 단계에 대해 동일한 형식으로 계속 작성)`;

                        try {
                            const text = await callGeminiAPI(prompt);
                            if (text) {
                                const formattedHtml = formatAiResponseToHtml(text);
                                outputDiv.innerHTML = `<div class="ai-response-prose mt-6 p-6 border-t-2 border-purple-200">${formattedHtml}</div>`;
                            }
                        } catch (error) {
                            outputDiv.innerHTML = `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mt-4 rounded-lg" role="alert"><p class="font-bold">오류 발생</p><p>AI 설계를 생성하는 중에 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.</p></div>`;
                        }
                    });
                }
            };

            modelNavBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modelNavBtns.forEach(b => b.classList.remove('active', 'bg-purple-100'));
                    btn.classList.add('active', 'bg-purple-100');
                    renderModelContent(btn.dataset.model);
                });
            });

            renderModelContent('inquiry');
            document.querySelector('.model-nav-btn[data-model="inquiry"]').classList.add('active', 'bg-purple-100');
        };

        const setupLessonPlannerSection = () => {
            const plannerSection = document.getElementById('lesson-planner');
            if(!plannerSection) return;
            plannerSection.innerHTML = `
                <h2 class="text-3xl font-bold text-center mb-4">성취기준별 맞춤 수업 설계</h2>
                <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">수업하실 학교급, 교과, 단원, 성취기준을 선택하시면, 성취기준에 최적화된 수업 아이디어를 얻으실 수 있습니다.</p>
                <div class="max-w-5xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-lg">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div>
                            <label for="school-level-select" class="block mb-2 text-sm font-medium text-gray-900">1. 학교급 선택</label>
                            <select id="school-level-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5">
                                <option selected>학교급을 선택하세요</option>
                                <option value="middleSchool">중학교</option>
                                <option value="highSchool">고등학교</option>
                            </select>
                        </div>
                        <div>
                            <label for="subject-select" class="block mb-2 text-sm font-medium text-gray-900">2. 교과 선택</label>
                            <select id="subject-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5" disabled>
                                <option selected>교과를 선택하세요</option>
                            </select>
                        </div>
                        <div>
                            <label for="unit-select" class="block mb-2 text-sm font-medium text-gray-900">3. 영역(단원) 선택</label>
                            <select id="unit-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5" disabled>
                                <option selected>영역(단원)을 선택하세요</option>
                            </select>
                        </div>
                        <div>
                            <label for="standard-select" class="block mb-2 text-sm font-medium text-gray-900">4. 성취기준 선택</label>
                            <select id="standard-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5" disabled>
                                <option selected>성취기준을 선택하세요</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-8">
                        <button id="generate-ai-guide-btn" class="w-full md:w-auto bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition duration-300 disabled:bg-gray-400" disabled>✨ AI 수업 활동 아이디어 생성 ✨</button>
                    </div>
                </div>
                <div id="gemini-guide-output" class="mt-8 max-w-5xl mx-auto"></div>`;

            const schoolLevelSelect = document.getElementById('school-level-select');
            const subjectSelect = document.getElementById('subject-select');
            const unitSelect = document.getElementById('unit-select');
            const standardSelect = document.getElementById('standard-select');
            const generateAIBtn = document.getElementById('generate-ai-guide-btn');
            const geminiGuideOutput = document.getElementById('gemini-guide-output');

            const resetSelect = (select, defaultText) => {
                select.innerHTML = `<option>${defaultText}</option>`;
                select.disabled = true;
            };

            const resetOutputs = () => {
                geminiGuideOutput.innerHTML = '';
            }

            schoolLevelSelect.addEventListener('change', () => {
                const schoolLevel = schoolLevelSelect.value;
                resetSelect(subjectSelect, '교과를 선택하세요');
                resetSelect(unitSelect, '영역(단원)을 선택하세요');
                resetSelect(standardSelect, '성취기준을 선택하세요');
                generateAIBtn.disabled = true;
                resetOutputs();
                if (lessonDesigns[schoolLevel]) {
                    subjectSelect.disabled = false;
                    Object.keys(lessonDesigns[schoolLevel]).forEach(subject => {
                        subjectSelect.innerHTML += `<option value="${subject}">${subject}</option>`;
                    });
                }
            });

            subjectSelect.addEventListener('change', () => {
                const schoolLevel = schoolLevelSelect.value;
                const subject = subjectSelect.value;
                resetSelect(unitSelect, '영역(단원)을 선택하세요');
                resetSelect(standardSelect, '성취기준을 선택하세요');
                generateAIBtn.disabled = true;
                resetOutputs();
                if (lessonDesigns[schoolLevel]?.[subject]) {
                    unitSelect.disabled = false;
                    Object.keys(lessonDesigns[schoolLevel][subject]).forEach(unit => {
                        unitSelect.innerHTML += `<option value="${unit}">${unit}</option>`;
                    });
                }
            });

            unitSelect.addEventListener('change', () => {
                const schoolLevel = schoolLevelSelect.value;
                const subject = subjectSelect.value;
                const unit = unitSelect.value;
                resetSelect(standardSelect, '성취기준을 선택하세요');
                generateAIBtn.disabled = true;
                resetOutputs();
                if (lessonDesigns[schoolLevel]?.[subject]?.[unit]) {
                    standardSelect.disabled = false;
                    Object.keys(lessonDesigns[schoolLevel][subject][unit]).forEach(standardKey => {
                        const standardData = lessonDesigns[schoolLevel][subject][unit][standardKey];
                        const standardText = standardData.standard;
                        standardSelect.innerHTML += `<option value="${standardKey}">${standardKey} ${standardText.substring(standardText.indexOf(']')+1, 50)}...</option>`;
                    });
                }
            });
            
            standardSelect.addEventListener('change', () => {
                const isStandardSelected = standardSelect.value.startsWith('[');
                generateAIBtn.disabled = !isStandardSelected;
                resetOutputs();
            });

            generateAIBtn.addEventListener('click', async () => {
                const schoolLevel = schoolLevelSelect.value;
                const subject = subjectSelect.value;
                const unit = unitSelect.value;
                const standardKey = standardSelect.value;
                const standardData = lessonDesigns[schoolLevel]?.[subject]?.[unit]?.[standardKey];

                if (!standardData) return;
                
                geminiGuideOutput.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg mt-8 border border-gray-200">
                        <h3 class="text-xl font-bold mb-4 text-indigo-700">✨ AI 추천 수업 활동 아이디어</h3>
                        <div class="flex flex-col items-center justify-center p-8">
                            <div class="loader"></div>
                            <p class="mt-4 text-gray-600">Gemini AI가 창의적인 아이디어를 생성 중입니다. 잠시만 기다려 주세요...</p>
                        </div>
                    </div>`;

                const prompt = `당신은 대한민국 교육과정 전문가이자 창의적인 수업 설계자입니다. 다음 성취기준에 기반하여, 학생들이 흥미를 느끼고 깊이 있게 탐구할 수 있는 '수업 활동 아이디어' 3가지를 제안해 주세요. 각 아이디어는 경기도교육청의 '하이러닝' 플랫폼 기능을 활용하여 학생들이 주도적으로 참여할 수 있어야 합니다.

각 아이디어에 대해 다음 형식으로 답변해주세요:

### [활동 제목]
* **활동 설명:** (활동에 대한 구체적인 설명)
* **활용 가능한 하이러닝 기능:** (구체적인 기능 명시)

---
**성취기준:** ${standardData.standard}`;

                try {
                    const text = await callGeminiAPI(prompt);
                    if (text) {
                        const formattedHtml = formatAiResponseToHtml(text);
                        geminiGuideOutput.innerHTML = `
                            <div class="bg-white p-6 rounded-xl shadow-lg mt-8 border border-gray-200 animate-fade-in">
                                <h3 class="text-xl font-bold mb-4 text-indigo-700">✨ AI 추천 수업 활동 아이디어</h3>
                                <div class="ai-response-prose">
                                   ${formattedHtml}
                                </div>
                            </div>`;
                    }
                } catch (error) {
                    geminiGuideOutput.innerHTML = `
                        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mt-8 rounded-lg" role="alert">
                            <p class="font-bold">오류 발생</p>
                            <p>AI 아이디어를 생성하는 중에 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.</p>
                        </div>`;
                }
            });
        };

        const setupQnaSection = () => {
            const qnaSection = document.getElementById('qna');
            if(!qnaSection) return;
            qnaSection.innerHTML = `
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-4">AI 하이러닝 Q&A</h2>
                <p class="max-w-2xl mx-auto text-center text-gray-600 mb-10 leading-relaxed">
                    하이러닝에 대해 궁금한 점이 있으신가요? 아래 카테고리를 선택하고 질문을 입력하시면, AI가 답변해 드립니다.
                </p>

                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="qna-category" class="block mb-2 text-sm font-medium text-gray-900">1. 질문 카테고리 선택</label>
                            <select id="qna-category" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5">
                                <option selected value="teacher">교사용 기능 문의</option>
                                <option value="student">학생/학부모용 기능 문의</option>
                                <option value="admin">학교 관리자 기능 문의</option>
                                <option value="design">수업 설계 및 활용법</option>
                                <option value="etc">기타 문의</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="qna-input" class="block mb-2 text-sm font-medium text-gray-900">2. 질문 입력</label>
                            <textarea id="qna-input" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" placeholder="예시) 클래스보드는 어떻게 만드나요?"></textarea>
                        </div>
                    </div>
                    <div class="text-center">
                         <button id="qna-submit-btn" class="w-full bg-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-purple-700 transition duration-300">AI에게 질문하기</button>
                    </div>

                    <div id="qna-output" class="mt-8"></div>
                </div>
            </div>
            `;

            const qnaSubmitBtn = document.getElementById('qna-submit-btn');
            qnaSubmitBtn.addEventListener('click', async () => {
                const category = document.getElementById('qna-category').value;
                const question = document.getElementById('qna-input').value;
                const outputDiv = document.getElementById('qna-output');

                if(!question.trim()) {
                    outputDiv.innerHTML = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg" role="alert"><p>질문 내용을 입력해주세요.</p></div>`;
                    return;
                }

                outputDiv.innerHTML = `<div class="flex flex-col items-center justify-center p-8"><div class="loader"></div><p class="mt-4 text-gray-600">AI가 답변을 생성 중입니다...</p></div>`;

                const prompt = `당신은 경기도교육청의 '하이러닝' 플랫폼 전문가입니다. 다음 질문에 대해 가장 정확하고 친절하게 답변해주세요. 답변은 Markdown 형식을 사용하여 제목, 강조, 목록 등을 포함해 체계적이고 가독성 높게 구성해야 합니다.

                **질문 카테고리:** ${category}
                **사용자 질문:** ${question}
                
                **답변 형식:**
                - 질문의 핵심을 파악하여 명확하고 간결하게 답변합니다.
                - 필요한 경우, 관련된 하이러닝의 특정 기능 명칭을 정확히 사용하여 단계별로 설명합니다.`;
                
                try {
                    const text = await callGeminiAPI(prompt);
                    if (text) {
                        const formattedHtml = formatAiResponseToHtml(text);
                        outputDiv.innerHTML = `<div class="mt-6 p-6 border-t-2 border-purple-200 ai-response-prose">${formattedHtml}</div>`;
                    }
                } catch (error) {
                    outputDiv.innerHTML = `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mt-4 rounded-lg" role="alert"><p class="font-bold">오류 발생</p><p>AI 답변을 생성하는 중에 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.</p></div>`;
                }
            });
        };
        
        setupAll();

    });
    </script>
</body>
</html>
